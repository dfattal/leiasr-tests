<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.2"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>LeiaSR SDK: Getting Started - C++/OpenGL Weaving</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="extrastyle.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="sr-logo.svg"/></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">LeiaSR SDK<span id="projectnumber">&#160;3e4093ae v1.34.8.37806 2025-10-23T12:33:42Z</span>
   </div>
   <div id="projectbrief">Stable</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.2 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Getting Started - C++/OpenGL Weaving </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_C__GitLabRunner_builds_fe33718a_0_simulatedreality_simulatedreality_modules_srOpenGL_documentation_doxygen_pages_opengl_weaving"></a></p>
<h1><a class="anchor" id="build_opengl"></a>
Build and run C++/OpenGL example</h1>
<ul>
<li>Navigate to the install directory. Then execute the following commands as administrator in "Windows PowerShell" <div class="fragment"><div class="line">cd examples/opengl_weaving</div>
<div class="line">mkdir build </div>
<div class="line">cd  build</div>
<div class="line">cmake -G &quot;Visual Studio 15 2017 Win64&quot; ..</div>
</div><!-- fragment --> <b>Note: </b><ul>
<li>To run these command as administrator, open the Start menu, and scroll to "Windows PowerShell", from the right-click menu, select "Run as administrator". <img src="RunAsAdmin.png" alt="" class="inline" title="Running Windows PowerShell as Administrator"/></li>
<li>Please take into account that you should select the correct input for <b> -G </b> parameter based on the installed Visual Studio on your system.</li>
</ul>
</li>
<li>Open Visual Studio as Administrator. To do so, open the Start menu, and scroll to Visual Studio, then from the right-click or context menu of Visual Studio, select More &gt; Run as administrator. When Visual Studio starts, (Administrator) appears after the product name in the title bar.</li>
<li>Then, open example_opengl_weaving.sln located in examples/opengl_weaving/build address in Visual Studio. Build example_opengl_weaving project and run it.</li>
<li>If the Eyetracker application is running a cube object is expected to be displayed in 3D. If the Eyetracker application is not running the default eye positions will be used. These are identical for the left and right perspective such that a stereo image with zero disparity will be presented. You will only be able to look around the cube in <a class="el" href="namespaceSR.html" title="Namespace containing all C++ Simulated Reality classes.">SR</a> if the Eyetracker application is running in the background.</li>
</ul>
<h1><a class="anchor" id="example_opengl"></a>
C++/OpenGL example</h1>
<ul>
<li>The expected behavior of the example is to display a cube object in 3D. This requires the eyetracker and handtracker run simultaneously.</li>
<li>Class <code>SREyePairListener</code> is the listener that accept eye pair coordinates from the <a class="el" href="classSR_1_1EyeTracker.html">EyeTracker</a> class.</li>
<li>To start streaming eye positions <a class="el" href="classSR_1_1SRContext.html">SRContext</a> has to be initialized: <div class="fragment"><div class="line"><a id="l00507" name="l00507"></a><span class="lineno">  507</span> </div>
<div class="line"><a id="l00508" name="l00508"></a><span class="lineno">  508</span>    <span class="keyword">const</span> <span class="keywordtype">double</span> startTime = (double)GetTickCount64() / 1000.0;</div>
<div class="line"><a id="l00509" name="l00509"></a><span class="lineno">  509</span> </div>
<div class="line"><a id="l00510" name="l00510"></a><span class="lineno">  510</span>    <span class="comment">// Create SR context.</span></div>
<div class="line"><a id="l00511" name="l00511"></a><span class="lineno">  511</span>    <span class="keywordflow">while</span> (g_srContext == <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00512" name="l00512"></a><span class="lineno">  512</span>    {</div>
<div class="line"><a id="l00513" name="l00513"></a><span class="lineno">  513</span>        <span class="keywordflow">try</span></div>
<div class="line"><a id="l00514" name="l00514"></a><span class="lineno">  514</span>        {</div>
<div class="line"><a id="l00515" name="l00515"></a><span class="lineno">  515</span>            g_srContext = <a class="code hl_function" href="classSR_1_1SRContext.html#ae3bbf70838bf6946a47f2be067621887">SR::SRContext::create</a>();</div>
<div class="line"><a id="l00516" name="l00516"></a><span class="lineno">  516</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00517" name="l00517"></a><span class="lineno">  517</span>        }</div>
<div class="line"><a id="l00518" name="l00518"></a><span class="lineno">  518</span>        <span class="keywordflow">catch</span> (<a class="code hl_class" href="classSR_1_1ServerNotAvailableException.html">SR::ServerNotAvailableException</a> e)</div>
<div class="line"><a id="l00519" name="l00519"></a><span class="lineno">  519</span>        {</div>
<div class="line"><a id="l00520" name="l00520"></a><span class="lineno">  520</span>            <span class="comment">// Ignore errors because SR may be starting-up.</span></div>
<div class="line"><a id="l00521" name="l00521"></a><span class="lineno">  521</span>        }</div>
<div class="line"><a id="l00522" name="l00522"></a><span class="lineno">  522</span> </div>
<div class="line"><a id="l00523" name="l00523"></a><span class="lineno">  523</span>        std::cout &lt;&lt; <span class="stringliteral">&quot;Waiting for context&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a id="l00524" name="l00524"></a><span class="lineno">  524</span> </div>
<div class="line"><a id="l00525" name="l00525"></a><span class="lineno">  525</span>        <span class="comment">// Wait a bit.</span></div>
<div class="line"><a id="l00526" name="l00526"></a><span class="lineno">  526</span>        Sleep(100);</div>
<div class="line"><a id="l00527" name="l00527"></a><span class="lineno">  527</span> </div>
<div class="line"><a id="l00528" name="l00528"></a><span class="lineno">  528</span>        <span class="comment">// Abort if we exceed the maximum allowed time.</span></div>
<div class="line"><a id="l00529" name="l00529"></a><span class="lineno">  529</span>        <span class="keywordtype">double</span> curTime = (double)GetTickCount64() / 1000.0;</div>
<div class="line"><a id="l00530" name="l00530"></a><span class="lineno">  530</span>        <span class="keywordflow">if</span> ((curTime - startTime) &gt; maxTime)</div>
<div class="line"><a id="l00531" name="l00531"></a><span class="lineno">  531</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00532" name="l00532"></a><span class="lineno">  532</span>    }</div>
<div class="line"><a id="l00533" name="l00533"></a><span class="lineno">  533</span> </div>
<div class="line"><a id="l00534" name="l00534"></a><span class="lineno">  534</span>    <span class="comment">// Wait for display to be ready.</span></div>
<div class="line"><a id="l00535" name="l00535"></a><span class="lineno">  535</span>    <span class="keywordtype">bool</span> displayReady = <span class="keyword">false</span>;</div>
<div class="line"><a id="l00536" name="l00536"></a><span class="lineno">  536</span>    <span class="keywordflow">while</span> (g_srContext &amp;&amp; !displayReady)</div>
<div class="line"><a id="l00537" name="l00537"></a><span class="lineno">  537</span>    {</div>
<div class="line"><a id="l00538" name="l00538"></a><span class="lineno">  538</span>        <span class="comment">// Attempt to get display.</span></div>
<div class="line"><a id="l00539" name="l00539"></a><span class="lineno">  539</span>        <a class="code hl_class" href="classSR_1_1Display.html">SR::Display</a>* display = <a class="code hl_function" href="classSR_1_1Display.html#a4dcdcc6f20eafd45f98d34890c792bd0">SR::Display::create</a>(*g_srContext);</div>
<div class="line"><a id="l00540" name="l00540"></a><span class="lineno">  540</span>        <span class="keywordflow">if</span> (display != <span class="keyword">nullptr</span>)</div>
<div class="line"><a id="l00541" name="l00541"></a><span class="lineno">  541</span>        {</div>
<div class="line"><a id="l00542" name="l00542"></a><span class="lineno">  542</span>            <span class="comment">// Get the display location, and when it is valid, the device is ready.</span></div>
<div class="line"><a id="l00543" name="l00543"></a><span class="lineno">  543</span>            <a class="code hl_union" href="unionSR__recti.html">SR_recti</a> displayLocation = display-&gt;<a class="code hl_function" href="classSR_1_1Display.html#a34c49b6aaeb97c4d0d07c629d1dd2e13">getLocation</a>();</div>
<div class="line"><a id="l00544" name="l00544"></a><span class="lineno">  544</span>            int64_t width = displayLocation.<a class="code hl_variable" href="unionSR__recti.html#aa0d00bd2c5340f41d0174e1062f11e39">right</a> - displayLocation.<a class="code hl_variable" href="unionSR__recti.html#adfa344c676fdd1fbb85563a4df011214">left</a>;</div>
<div class="line"><a id="l00545" name="l00545"></a><span class="lineno">  545</span>            int64_t height = displayLocation.<a class="code hl_variable" href="unionSR__recti.html#aba1069d7251abd8c189f63837d1d1619">bottom</a> - displayLocation.<a class="code hl_variable" href="unionSR__recti.html#a90bb1d7d723752dd3df29ab71c627f83">top</a>;</div>
<div class="line"><a id="l00546" name="l00546"></a><span class="lineno">  546</span>            <span class="keywordflow">if</span> ((width != 0) &amp;&amp; (height != 0))</div>
<div class="line"><a id="l00547" name="l00547"></a><span class="lineno">  547</span>            {</div>
<div class="line"><a id="l00548" name="l00548"></a><span class="lineno">  548</span>                displayReady = <span class="keyword">true</span>;</div>
<div class="line"><a id="l00549" name="l00549"></a><span class="lineno">  549</span>                <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00550" name="l00550"></a><span class="lineno">  550</span>            }</div>
<div class="line"><a id="l00551" name="l00551"></a><span class="lineno">  551</span>        }</div>
<div class="line"><a id="l00552" name="l00552"></a><span class="lineno">  552</span> </div>
<div class="line"><a id="l00553" name="l00553"></a><span class="lineno">  553</span>        std::cout &lt;&lt; <span class="stringliteral">&quot;Waiting for display&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"><a id="l00554" name="l00554"></a><span class="lineno">  554</span> </div>
<div class="line"><a id="l00555" name="l00555"></a><span class="lineno">  555</span>        <span class="comment">// Wait a bit.</span></div>
<div class="line"><a id="l00556" name="l00556"></a><span class="lineno">  556</span>        Sleep(100);</div>
<div class="line"><a id="l00557" name="l00557"></a><span class="lineno">  557</span> </div>
<div class="line"><a id="l00558" name="l00558"></a><span class="lineno">  558</span>        <span class="comment">// Abort if we exceed the maximum allowed time.</span></div>
<div class="line"><a id="l00559" name="l00559"></a><span class="lineno">  559</span>        <span class="keywordtype">double</span> curTime = (double)GetTickCount64() / 1000.0;</div>
<div class="line"><a id="l00560" name="l00560"></a><span class="lineno">  560</span>        <span class="keywordflow">if</span> ((curTime - startTime) &gt; maxTime)</div>
<div class="line"><a id="l00561" name="l00561"></a><span class="lineno">  561</span>            <span class="keywordflow">break</span>;</div>
<div class="line"><a id="l00562" name="l00562"></a><span class="lineno">  562</span>    }</div>
<div class="line"><a id="l00563" name="l00563"></a><span class="lineno">  563</span> </div>
<div class="ttc" id="aclassSR_1_1Display_html"><div class="ttname"><a href="classSR_1_1Display.html">SR::Display</a></div><div class="ttdoc">Class of WorldObject representing the SR display in real space.</div><div class="ttdef"><b>Definition:</b> display.h:31</div></div>
<div class="ttc" id="aclassSR_1_1Display_html_a34c49b6aaeb97c4d0d07c629d1dd2e13"><div class="ttname"><a href="classSR_1_1Display.html#a34c49b6aaeb97c4d0d07c629d1dd2e13">SR::Display::getLocation</a></div><div class="ttdeci">virtual SR_recti getLocation()=0</div><div class="ttdoc">Finds the SR monitor and return it's location in the display configuration.</div></div>
<div class="ttc" id="aclassSR_1_1Display_html_a4dcdcc6f20eafd45f98d34890c792bd0"><div class="ttname"><a href="classSR_1_1Display.html#a4dcdcc6f20eafd45f98d34890c792bd0">SR::Display::create</a></div><div class="ttdeci">static Display * create(SRContext &amp;context)</div><div class="ttdoc">Creates an instance of a Display class.</div></div>
<div class="ttc" id="aclassSR_1_1SRContext_html_ae3bbf70838bf6946a47f2be067621887"><div class="ttname"><a href="classSR_1_1SRContext.html#ae3bbf70838bf6946a47f2be067621887">SR::SRContext::create</a></div><div class="ttdeci">static SRContext * create(NetworkMode mode=NetworkMode::NonBlockingClientMode)</div><div class="ttdoc">create new SRContext instance</div></div>
<div class="ttc" id="aclassSR_1_1ServerNotAvailableException_html"><div class="ttname"><a href="classSR_1_1ServerNotAvailableException.html">SR::ServerNotAvailableException</a></div><div class="ttdoc">Class of Exception which indicates that a SR Service was not available to connect with.</div><div class="ttdef"><b>Definition:</b> exception.h:96</div></div>
<div class="ttc" id="aunionSR__recti_html"><div class="ttname"><a href="unionSR__recti.html">SR_recti</a></div><div class="ttdoc">C-compatible integer rectangle representation.</div><div class="ttdef"><b>Definition:</b> types.h:107</div></div>
<div class="ttc" id="aunionSR__recti_html_a90bb1d7d723752dd3df29ab71c627f83"><div class="ttname"><a href="unionSR__recti.html#a90bb1d7d723752dd3df29ab71c627f83">SR_recti::top</a></div><div class="ttdeci">int64_t top</div><div class="ttdoc">Top-most border in the rectangle.</div><div class="ttdef"><b>Definition:</b> types.h:115</div></div>
<div class="ttc" id="aunionSR__recti_html_aa0d00bd2c5340f41d0174e1062f11e39"><div class="ttname"><a href="unionSR__recti.html#aa0d00bd2c5340f41d0174e1062f11e39">SR_recti::right</a></div><div class="ttdeci">int64_t right</div><div class="ttdoc">Right-most border in the rectangle.</div><div class="ttdef"><b>Definition:</b> types.h:116</div></div>
<div class="ttc" id="aunionSR__recti_html_aba1069d7251abd8c189f63837d1d1619"><div class="ttname"><a href="unionSR__recti.html#aba1069d7251abd8c189f63837d1d1619">SR_recti::bottom</a></div><div class="ttdeci">int64_t bottom</div><div class="ttdoc">Bottom-most border in the rectangle.</div><div class="ttdef"><b>Definition:</b> types.h:117</div></div>
<div class="ttc" id="aunionSR__recti_html_adfa344c676fdd1fbb85563a4df011214"><div class="ttname"><a href="unionSR__recti.html#adfa344c676fdd1fbb85563a4df011214">SR_recti::left</a></div><div class="ttdeci">int64_t left</div><div class="ttdoc">Left-most border in the rectangle.</div><div class="ttdef"><b>Definition:</b> types.h:114</div></div>
</div><!-- fragment --></li>
<li>The OpenGL library is used to draw objects. For the extensive tutorial on how to visualize objects in OpenGL follow the <a href="http://www.opengl-tutorial.org/">link</a>. In this guide we briefly point out that OpenGL objects are represented by a buffer of vertices (surface of each object can be represented by a set of triangles. Each of these triangles is represented by three vertices in 3D space) and by a buffer of the vertices' colors. In this example a cube is drawn using 12 triangles.</li>
<li>Once the object is defined in the buffers it can be further visualized in a desired location and for a desired viewpoint. Those transformations are done in the <code>CalculateModelViewProjectionMatrix()</code> function. Rendering is done using OpenGL function <code>glDrawElements()</code>.</li>
<li>In order to visualize 3D object both left and right eyes, images have to be rendered. Therefore projection matrix is computed for the left and for the right eyes: <div class="fragment"><div class="line"><a id="l01071" name="l01071"></a><span class="lineno"> 1071</span> </div>
<div class="line"><a id="l01072" name="l01072"></a><span class="lineno"> 1072</span>        <span class="comment">// Render cube into stereo view texture.</span></div>
<div class="line"><a id="l01073" name="l01073"></a><span class="lineno"> 1073</span> </div>
<div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span> </div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>        <span class="comment">// Set view texture as target.</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span><span class="preprocessor">#if defined(USE_DEPRECATED_WEAVER)</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>        <span class="keywordflow">if</span> (!g_useDeprecatedFramebuffer || (g_demoMode == eDemoMode::StereoImage))</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>        {</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>            <span class="comment">// Use the app-provided view texture.</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>            glBindFramebuffer(GL_FRAMEBUFFER, g_viewFramebuffer);</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>        }</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>        {</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>            <span class="comment">// Use the deprecated weaver-provided view texture.</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>            <a class="code hl_typedef" href="glweaver_8h.html#aa311c7f0d6ec4f1a33f9235c3651b86b">GLuint</a> View = g_srWeaver-&gt;getFrameBuffer();</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>            glBindFramebuffer(GL_FRAMEBUFFER, View);</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        }</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        glBindFramebuffer(GL_FRAMEBUFFER, g_viewFramebuffer);</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>        <span class="comment">// Clear view texture to blue</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>        glClearColor(GetSRGB(0.05f), GetSRGB(0.05f), GetSRGB(0.25f), GetSRGB(1.0f));</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span> </div>
<div class="line"><a id="l01098" name="l01098"></a><span class="lineno"> 1098</span> </div>
<div class="line"><a id="l01099" name="l01099"></a><span class="lineno"> 1099</span>        <span class="comment">// Render stereo views.</span></div>
<div class="line"><a id="l01100" name="l01100"></a><span class="lineno"> 1100</span>        <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; 2; i++)</div>
<div class="line"><a id="l01101" name="l01101"></a><span class="lineno"> 1101</span>        {</div>
<div class="line"><a id="l01102" name="l01102"></a><span class="lineno"> 1102</span>            <span class="comment">// Set viewport to render to left, then right.</span></div>
<div class="line"><a id="l01103" name="l01103"></a><span class="lineno"> 1103</span>            glViewport(i * g_viewTextureWidth, 0, g_viewTextureWidth, g_viewTextureHeight);</div>
<div class="line"><a id="l01104" name="l01104"></a><span class="lineno"> 1104</span> </div>
<div class="line"><a id="l01105" name="l01105"></a><span class="lineno"> 1105</span>            <span class="comment">// Get transform matrix.</span></div>
<div class="line"><a id="l01106" name="l01106"></a><span class="lineno"> 1106</span>            mat4f mvp = CalculateModelViewProjectionMatrix((i == 0) ? leftEye : rightEye, (<span class="keywordtype">float</span>)elapsedTime);</div>
<div class="line"><a id="l01107" name="l01107"></a><span class="lineno"> 1107</span> </div>
<div class="line"><a id="l01108" name="l01108"></a><span class="lineno"> 1108</span>            <span class="comment">// Draw.</span></div>
<div class="line"><a id="l01109" name="l01109"></a><span class="lineno"> 1109</span>            glUseProgram(g_shaderProgram);</div>
<div class="line"><a id="l01110" name="l01110"></a><span class="lineno"> 1110</span>            glUniformMatrix4fv(g_uniformTransform, 1, GL_FALSE, (<span class="keyword">const</span> GLfloat*) &amp;mvp);</div>
<div class="line"><a id="l01111" name="l01111"></a><span class="lineno"> 1111</span>            glBindVertexArray(g_vao);</div>
<div class="line"><a id="l01112" name="l01112"></a><span class="lineno"> 1112</span>            glEnableVertexAttribArray(g_vaoVertexXYZAttributeIndex);</div>
<div class="line"><a id="l01113" name="l01113"></a><span class="lineno"> 1113</span>            glEnableVertexAttribArray(g_vaoVertexRGBAttributeIndex);</div>
<div class="line"><a id="l01114" name="l01114"></a><span class="lineno"> 1114</span>            glDrawElements(GL_TRIANGLES, g_vaoIndexCount, GL_UNSIGNED_INT, NULL);</div>
<div class="line"><a id="l01115" name="l01115"></a><span class="lineno"> 1115</span>            glDisableVertexAttribArray(g_vaoVertexXYZAttributeIndex);</div>
<div class="line"><a id="l01116" name="l01116"></a><span class="lineno"> 1116</span>            glDisableVertexAttribArray(g_vaoVertexRGBAttributeIndex);</div>
<div class="line"><a id="l01117" name="l01117"></a><span class="lineno"> 1117</span>        }</div>
<div class="line"><a id="l01118" name="l01118"></a><span class="lineno"> 1118</span> </div>
<div class="ttc" id="aglweaver_8h_html_aa311c7f0d6ec4f1a33f9235c3651b86b"><div class="ttname"><a href="glweaver_8h.html#aa311c7f0d6ec4f1a33f9235c3651b86b">GLuint</a></div><div class="ttdeci">unsigned int GLuint</div><div class="ttdef"><b>Definition:</b> glweaver.h:24</div></div>
</div><!-- fragment --></li>
<li>Left and right images are stitched together by sequentially applying <code>glViewport()</code> function and rendered by <code>glDrawElements()</code> function. Subsequently, this image is passed to the weaving part of the <a class="el" href="namespaceSR.html" title="Namespace containing all C++ Simulated Reality classes.">SR</a> SDK. During the weaving process pixels corresponding to the left and right images are distributed over the pixels of the display according to the display specifications and its calibration.</li>
</ul>
<h1><a class="anchor" id="weaving"></a>
C++/OpenGL example weaving</h1>
<p ><b>Note:</b></p><ul>
<li>Weaving in our context is the process that for every subpixel (red,green,blue) selects which view (left,right) should be shown. Every subpixel can only be seen from certain angles, so for every subpixel it is determined whether the right eye or left eye of the user is closest to the direction in which this subpixel can be seen.</li>
</ul>
<p >Loading weaving parameters and setting up a weaving shader has been encapsulated in the GLWeaver class for this example. This class provides a framebuffer that we can render our existing output to. Doing so will allow us to get weaving set up quickly and without having to compromise our existing application.</p>
<p >To convert the existing application which renders side-by-side output to one that uses software to weave an image for our <a class="el" href="namespaceSR.html" title="Namespace containing all C++ Simulated Reality classes.">SR</a> devices, we need to make three small modifications.</p><ul>
<li>We need to construct a GLWeaver instance. We only have to provide the size at which we want to render our scene side-by-side: <div class="fragment"><div class="line"><a id="l00606" name="l00606"></a><span class="lineno">  606</span> </div>
<div class="line"><a id="l00607" name="l00607"></a><span class="lineno">  607</span>    <span class="comment">// Create weaver.</span></div>
<div class="line"><a id="l00608" name="l00608"></a><span class="lineno">  608</span><span class="preprocessor">#ifdef USE_DEPRECATED_WEAVER</span></div>
<div class="line"><a id="l00609" name="l00609"></a><span class="lineno">  609</span>    g_srWeaver = <span class="keyword">new</span> <a class="code hl_class" href="classSR_1_1PredictingGLWeaver.html">SR::PredictingGLWeaver</a>(*g_srContext, g_viewTextureWidth * 2, g_viewTextureHeight, GetTextureFormat(), g_hWnd);</div>
<div class="line"><a id="l00610" name="l00610"></a><span class="lineno">  610</span>    <span class="keywordflow">if</span> (!g_useDeprecatedFramebuffer || (g_demoMode == eDemoMode::StereoImage))</div>
<div class="line"><a id="l00611" name="l00611"></a><span class="lineno">  611</span>        g_srWeaver-&gt;setInputFrameBuffer(g_viewFramebuffer, g_viewTexture);</div>
<div class="line"><a id="l00612" name="l00612"></a><span class="lineno">  612</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l00613" name="l00613"></a><span class="lineno">  613</span>    <a class="code hl_enumeration" href="WeaverTypes_8h.html#a48bc87565a96cbdb4ca4bb3d4f3290f2">WeaverErrorCode</a> createWeaverResult = <a class="code hl_function" href="namespaceSR.html#a2e362c213be289ae37f98560e8e977c8">SR::CreateGLWeaver</a>(*g_srContext, g_hWnd, &amp;g_srWeaver);</div>
<div class="line"><a id="l00614" name="l00614"></a><span class="lineno">  614</span>    <span class="keywordflow">if</span> (createWeaverResult != <a class="code hl_enumvalue" href="WeaverTypes_8h.html#a48bc87565a96cbdb4ca4bb3d4f3290f2a62b68402344f76fadc9bb194a8763e8e">WeaverErrorCode::WeaverSuccess</a>)</div>
<div class="line"><a id="l00615" name="l00615"></a><span class="lineno">  615</span>    {</div>
<div class="line"><a id="l00616" name="l00616"></a><span class="lineno">  616</span>        OnError(<span class="stringliteral">&quot;Failed to create weaver&quot;</span>);</div>
<div class="line"><a id="l00617" name="l00617"></a><span class="lineno">  617</span>        <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a id="l00618" name="l00618"></a><span class="lineno">  618</span>    }</div>
<div class="line"><a id="l00619" name="l00619"></a><span class="lineno">  619</span>    g_srWeaver-&gt;setInputViewTexture(g_viewTexture, g_viewTextureWidth, g_viewTextureHeight, GetTextureFormat());</div>
<div class="line"><a id="l00620" name="l00620"></a><span class="lineno">  620</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l00621" name="l00621"></a><span class="lineno">  621</span> </div>
<div class="ttc" id="aWeaverTypes_8h_html_a48bc87565a96cbdb4ca4bb3d4f3290f2"><div class="ttname"><a href="WeaverTypes_8h.html#a48bc87565a96cbdb4ca4bb3d4f3290f2">WeaverErrorCode</a></div><div class="ttdeci">WeaverErrorCode</div><div class="ttdef"><b>Definition:</b> WeaverTypes.h:12</div></div>
<div class="ttc" id="aWeaverTypes_8h_html_a48bc87565a96cbdb4ca4bb3d4f3290f2a62b68402344f76fadc9bb194a8763e8e"><div class="ttname"><a href="WeaverTypes_8h.html#a48bc87565a96cbdb4ca4bb3d4f3290f2a62b68402344f76fadc9bb194a8763e8e">WeaverSuccess</a></div><div class="ttdeci">@ WeaverSuccess</div><div class="ttdef"><b>Definition:</b> WeaverTypes.h:13</div></div>
<div class="ttc" id="aclassSR_1_1PredictingGLWeaver_html"><div class="ttname"><a href="classSR_1_1PredictingGLWeaver.html">SR::PredictingGLWeaver</a></div><div class="ttdef"><b>Definition:</b> glweaver.h:254</div></div>
<div class="ttc" id="anamespaceSR_html_a2e362c213be289ae37f98560e8e977c8"><div class="ttname"><a href="namespaceSR.html#a2e362c213be289ae37f98560e8e977c8">SR::CreateGLWeaver</a></div><div class="ttdeci">DIMENCOSR_API WeaverErrorCode CreateGLWeaver(SRContext &amp;context, HWND window, IGLWeaver1 **weaver)</div><div class="ttdoc">Creates a new OpenGL weaver.</div></div>
</div><!-- fragment --></li>
<li>Next our render loop needs to start by binding the framebuffer provided by the GLWeaver: <div class="fragment"><div class="line"><a id="l01075" name="l01075"></a><span class="lineno"> 1075</span> </div>
<div class="line"><a id="l01076" name="l01076"></a><span class="lineno"> 1076</span>        <span class="comment">// Set view texture as target.</span></div>
<div class="line"><a id="l01077" name="l01077"></a><span class="lineno"> 1077</span><span class="preprocessor">#if defined(USE_DEPRECATED_WEAVER)</span></div>
<div class="line"><a id="l01078" name="l01078"></a><span class="lineno"> 1078</span>        <span class="keywordflow">if</span> (!g_useDeprecatedFramebuffer || (g_demoMode == eDemoMode::StereoImage))</div>
<div class="line"><a id="l01079" name="l01079"></a><span class="lineno"> 1079</span>        {</div>
<div class="line"><a id="l01080" name="l01080"></a><span class="lineno"> 1080</span>            <span class="comment">// Use the app-provided view texture.</span></div>
<div class="line"><a id="l01081" name="l01081"></a><span class="lineno"> 1081</span>            glBindFramebuffer(GL_FRAMEBUFFER, g_viewFramebuffer);</div>
<div class="line"><a id="l01082" name="l01082"></a><span class="lineno"> 1082</span>        }</div>
<div class="line"><a id="l01083" name="l01083"></a><span class="lineno"> 1083</span>        <span class="keywordflow">else</span></div>
<div class="line"><a id="l01084" name="l01084"></a><span class="lineno"> 1084</span>        {</div>
<div class="line"><a id="l01085" name="l01085"></a><span class="lineno"> 1085</span>            <span class="comment">// Use the deprecated weaver-provided view texture.</span></div>
<div class="line"><a id="l01086" name="l01086"></a><span class="lineno"> 1086</span>            <a class="code hl_typedef" href="glweaver_8h.html#aa311c7f0d6ec4f1a33f9235c3651b86b">GLuint</a> View = g_srWeaver-&gt;getFrameBuffer();</div>
<div class="line"><a id="l01087" name="l01087"></a><span class="lineno"> 1087</span>            glBindFramebuffer(GL_FRAMEBUFFER, View);</div>
<div class="line"><a id="l01088" name="l01088"></a><span class="lineno"> 1088</span>        }</div>
<div class="line"><a id="l01089" name="l01089"></a><span class="lineno"> 1089</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01090" name="l01090"></a><span class="lineno"> 1090</span>        glBindFramebuffer(GL_FRAMEBUFFER, g_viewFramebuffer);</div>
<div class="line"><a id="l01091" name="l01091"></a><span class="lineno"> 1091</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01092" name="l01092"></a><span class="lineno"> 1092</span> </div>
<div class="line"><a id="l01093" name="l01093"></a><span class="lineno"> 1093</span>        <span class="comment">// Clear view texture to blue</span></div>
<div class="line"><a id="l01094" name="l01094"></a><span class="lineno"> 1094</span>        glClearColor(GetSRGB(0.05f), GetSRGB(0.05f), GetSRGB(0.25f), GetSRGB(1.0f));</div>
<div class="line"><a id="l01095" name="l01095"></a><span class="lineno"> 1095</span>        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);</div>
<div class="line"><a id="l01096" name="l01096"></a><span class="lineno"> 1096</span> </div>
</div><!-- fragment --> The render loop can continue as normal, objects like the pyramid in this example can be rendered to the bound framebuffer. The application can define their own shaders to do so.</li>
<li>Finally we should bind the default framebuffer again and use the <code>weave</code> function to generate our final output. <div class="fragment"><div class="line"><a id="l01123" name="l01123"></a><span class="lineno"> 1123</span> </div>
<div class="line"><a id="l01124" name="l01124"></a><span class="lineno"> 1124</span>    <span class="comment">// Set viewport to cover entire window.</span></div>
<div class="line"><a id="l01125" name="l01125"></a><span class="lineno"> 1125</span>    glBindFramebuffer(GL_FRAMEBUFFER, 0);</div>
<div class="line"><a id="l01126" name="l01126"></a><span class="lineno"> 1126</span>    glViewport(0, 0, g_windowWidth, g_windowHeight);</div>
<div class="line"><a id="l01127" name="l01127"></a><span class="lineno"> 1127</span> </div>
<div class="line"><a id="l01128" name="l01128"></a><span class="lineno"> 1128</span>    <span class="comment">// Perform weaving.</span></div>
<div class="line"><a id="l01129" name="l01129"></a><span class="lineno"> 1129</span><span class="preprocessor">#if !defined(USE_DEPRECATED_WEAVER)</span></div>
<div class="line"><a id="l01130" name="l01130"></a><span class="lineno"> 1130</span>    g_srWeaver-&gt;weave();</div>
<div class="line"><a id="l01131" name="l01131"></a><span class="lineno"> 1131</span><span class="preprocessor">#else</span></div>
<div class="line"><a id="l01132" name="l01132"></a><span class="lineno"> 1132</span>    <span class="comment">// NOTE: runtimes &lt;1.34 do not support non-fullscreen windows, nor non-fullscreen viewports!</span></div>
<div class="line"><a id="l01133" name="l01133"></a><span class="lineno"> 1133</span>    <span class="comment">// NOTE: runtimes &lt;1.34 need the fullscreen size as input to the weave function, &gt;=1.34 will ignore it</span></div>
<div class="line"><a id="l01134" name="l01134"></a><span class="lineno"> 1134</span> </div>
<div class="line"><a id="l01135" name="l01135"></a><span class="lineno"> 1135</span>    g_srWeaver-&gt;weave(<span class="comment">/* ignored in runtime &gt;=1.34 */</span> g_windowWidth, <span class="comment">/* ignored in runtime &gt;=1.34 */</span>g_windowHeight);</div>
<div class="line"><a id="l01136" name="l01136"></a><span class="lineno"> 1136</span><span class="preprocessor">#endif</span></div>
<div class="line"><a id="l01137" name="l01137"></a><span class="lineno"> 1137</span> </div>
</div><!-- fragment --> The <code>weave</code> function simply combines pixels from the side-by-side left and right images in a very specific way. These combined colors are used to display an image on the LCD panel under the <a class="el" href="namespaceSR.html" title="Namespace containing all C++ Simulated Reality classes.">SR</a> lens. Your eyes will only see colors meant for left or right after the light passes through the physical lens. </li>
</ul>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.2
</small></address>
</body>
</html>

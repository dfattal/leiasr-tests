# LeiaSR Display API Migration Tool - Developer Guide

**Version 1.2.0** | Last Updated: 2025-10-24

## Quick Reference for Developers

This guide provides essential information for developers migrating from the legacy `SR::Display` API to the modern `SR::IDisplayManager` API.

---

## üöÄ Getting Started (30 Seconds)

```cmd
# Download from: MIGRATION-TOOL/release/leiasr-migrate.exe

# Analyze your project
leiasr-migrate.exe analyze C:\your\project

# Migrate (modern mode - recommended)
leiasr-migrate.exe migrate C:\your\project --yes

# Or migrate with backward compatibility
leiasr-migrate.exe migrate C:\your\project --legacy-fallback --yes
```

---

## üéØ Which Mode Should I Use?

### Modern Mode (DEFAULT) ‚úÖ Recommended
**Use when:**
- Deploying with SDK 1.34.8-RC1 or later
- You want clean, modern code
- No need for runtime compatibility with older SDKs

**Results:**
```cpp
SR::IDisplayManager* displayMgr = SR::GetDisplayManagerInstance(context);
SR::IDisplay* display = displayMgr->getPrimaryActiveSRDisplay();
```

### Legacy Fallback Mode
**Use when:**
- Need backward compatibility with older SDK runtimes
- Deploying to systems that may have older SDK versions
- Want runtime fallback support

**Results:**
```cpp
#define SRDISPLAY_LAZYBINDING
#include "display_helper.h"
SR::Helper::DisplayAccess display(context);
```

---

## üìù Migration Workflow

### Step 1: Analyze
```cmd
leiasr-migrate.exe analyze C:\your\project --report=analysis.txt
```
Review the analysis report to understand what will change.

### Step 2: Test Migration (Dry Run)
```cmd
leiasr-migrate.exe migrate C:\your\project --dry-run
```
See all transformations without modifying files.

### Step 3: Perform Migration
```cmd
leiasr-migrate.exe migrate C:\your\project --yes
```
Original files backed up with `.legacy` extension.

### Step 4: Build & Test
```cmd
cmake --build build --config Release
```
Test your application thoroughly.

### Step 5: Clean Up (Optional)
```cmd
# If everything works, delete backups
del /S *.legacy
```

---

## üîÑ API Transformation Examples

### Example 1: Basic Display Creation

**Before:**
```cpp
SR::Display* display = SR::Display::create(*context);
```

**After (Modern):**
```cpp
SR::IDisplayManager* displayMgr_display = SR::GetDisplayManagerInstance(*context);
SR::IDisplay* display = displayMgr_display->getPrimaryActiveSRDisplay();
```

**After (Legacy Fallback):**
```cpp
SR::Helper::DisplayAccess display(*context);
```

### Example 2: Nullptr Checks

**Before:**
```cpp
if (display != nullptr) {
    // Use display
}
```

**After (Modern):** *Unchanged - still uses pointer*
```cpp
if (display != nullptr) {
    // Use display
}
```

**After (Legacy Fallback):** *Converted to validity check*
```cpp
if (display.isDisplayValid()) {
    // Use display
}
```

### Example 3: Multiple Display Instances

**Before:**
```cpp
SR::Display* display1 = SR::Display::create(*context);
SR::Display* display2 = SR::Display::create(*context);
```

**After (Modern):**
```cpp
SR::IDisplayManager* displayMgr_display1 = SR::GetDisplayManagerInstance(*context);
SR::IDisplay* display1 = displayMgr_display1->getPrimaryActiveSRDisplay();
SR::IDisplayManager* displayMgr_display2 = SR::GetDisplayManagerInstance(*context);
SR::IDisplay* display2 = displayMgr_display2->getPrimaryActiveSRDisplay();
```

---

## üõ†Ô∏è Build Configuration

### Modern Mode
No special configuration needed - just ensure SDK 1.34.8-RC1+ is installed.

### Legacy Fallback Mode
Add to your `CMakeLists.txt`:
```cmake
add_definitions(-DSRDISPLAY_LAZYBINDING)
```

Ensure `display_helper.h` is in your include path (auto-generated by tool).

---

## ‚úÖ Validation

### Working Migration Examples
See `EXAMPLES/migration-results/` for complete, validated examples:

- **Modern mode**: DirectX 11 example (226 KB exe)
- **Legacy fallback**: DirectX 11 example (228 KB exe)

Both examples include:
- Source code (before/after)
- Built executables
- Helper files (legacy mode only)

---

## üêõ Common Issues & Solutions

### Issue: "No files require migration"
**Solution:**
- Check that files use `#include "sr/world/display/display.h"`
- Verify `SR::Display::create()` exists in code
- Run analyze first to see what's detected

### Issue: Build errors about `IDisplayManager`
**Solution:**
- Ensure SDK 1.34.8-RC1+ is installed
- Check include paths point to correct SDK
- For legacy mode, verify `display_helper.h` was created

### Issue: Runtime crashes after migration
**Solution (Modern):**
- Verify SDK runtime version (1.34.8-RC1+)
- Check display initialization order
- Add null checks for display pointers

**Solution (Legacy Fallback):**
- Use `isDisplayValid()` before accessing display
- Check console for DisplayAccess initialization messages
- Verify both old and new runtime DLLs are accessible

---

## üìä Performance Considerations

### Modern Mode
- Slightly more verbose code (2 lines vs 1)
- Direct API calls - no wrapper overhead
- Best performance for new deployments

### Legacy Fallback Mode
- Runtime checks for API availability
- Minimal overhead from DisplayAccess wrapper
- Seamless fallback to legacy Display class

---

## üîí Safety Features

1. **Automatic Backups**: All original files saved as `*.legacy`
2. **Dry Run Mode**: Preview changes before applying
3. **Reversible**: Easy to rollback using backups or version control
4. **Non-Destructive Analysis**: Analyze mode never modifies files
5. **Detailed Reporting**: See exactly what will change

---

## üì¶ Tool Information

- **Executable Size**: 7.9 MB (standalone, no dependencies)
- **Platform**: Windows 10+ (64-bit)
- **Languages Supported**: C++ (C API migration not yet supported)
- **File Types**: `.cpp`, `.h`, `.hpp`, `.cc`, `.cxx`

---

## üö¶ Migration Checklist

- [ ] Backup your project (version control or manual copy)
- [ ] Run analyze to review changes
- [ ] Run dry-run migration to preview transformations
- [ ] Choose migration mode (modern vs legacy fallback)
- [ ] Perform actual migration
- [ ] Update build configuration if needed (legacy mode)
- [ ] Build project
- [ ] Test thoroughly
- [ ] Verify on target deployment environment
- [ ] Clean up `.legacy` backup files

---

## üìö Additional Resources

### In This Repository
- `MIGRATION-TOOL/release/README.md` - Complete user documentation
- `MIGRATION-TOOL/release/QUICKSTART.txt` - Quick reference card
- `MIGRATION-TOOL/release/CHANGELOG.md` - Version history
- `EXAMPLES/migration-results/` - Working examples

### Workflows
- `.github/workflows/build-migration-tool.yml` - How tool is built
- `.github/workflows/test-migration-tool.yml` - Automated testing
- `.github/workflows/build-migrated-examples.yml` - Example builds

---

## üí° Tips & Best Practices

1. **Always run analyze first** to understand the scope of changes
2. **Use dry-run mode** before actual migration
3. **Test modern mode first** - it's simpler and recommended for new deployments
4. **Keep .legacy backups** until thoroughly tested
5. **Commit to version control** before and after migration
6. **Test on actual hardware** - don't just rely on successful compilation

---

## üìû Support

For issues or questions:
- Review documentation in `release/` folder
- Check working examples in `EXAMPLES/migration-results/`
- Examine test workflows in `.github/workflows/`

---

**Copyright (c) 2025 Leia Inc.**
